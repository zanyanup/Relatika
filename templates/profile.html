{% extends "base.html" %}
{% block content %}
<h2>Profile</h2>
<form action="/profile" method="post" enctype="multipart/form-data">
    <label for="name">Name:</label>
    <input type="text" id="name" name="name" value="{{ user_name }}" required>
    <br>
    <label for="age">Age:</label>
    <input type="number" id="age" name="age" value="{{ user_age }}" required>
    <br>
    <label for="gender">Gender:</label>
    <select id="gender" name="gender">
        <option value="M" {% if user_gender == 'M' %}selected{% endif %}>Male</option>
        <option value="F" {% if user_gender == 'F' %}selected{% endif %}>Female</option>
        <option value="O" {% if user_gender == 'O' %}selected{% endif %}>Other</option>
    </select>
    <br>
    <label for="looking_for">Looking for:</label>
    <input type="checkbox" name="looking_for" value="M" {% if 'M' in (user_looking_for or '') %}checked{% endif %}> Male
    <input type="checkbox" name="looking_for" value="F" {% if 'F' in (user_looking_for or '') %}checked{% endif %}> Female
    <input type="checkbox" name="looking_for" value="D" {% if 'D' in (user_looking_for or '') %}checked{% endif %}> Doesn't matter
    <br>
    <label for="location">Location:</label>
    <select id="location" name="location">
        {% for loc in locations %}
            <option value="{{ loc }}" {% if user_location == loc %}selected{% endif %}>{{ loc }}</option>
        {% endfor %}
    </select>
    <br>
    <label for="about">About:</label>
    <textarea name="about" id="about" rows="10" cols="50">{{ user_about }}</textarea>
    <br>
    <label for="photos">Upload photos (up to 3):</label>
    <input type="file" name="photos" id="photos" multiple>
    <br>
    {% if user_photos %}
        <h3>Uploaded Photos:</h3>
        {% for photo in user_photos %}
            <div class="photo-container" style="display: inline-block; position: relative;">
                <img src="{{ url_for('static', filename='uploads/' ~ photo['filename']) }}" alt="User Photo" style="width:150px; height:150px;">
                <button type="button" class="delete-photo" data-filename="{{ photo['filename'] }}" style="position: absolute; top: 0; right: 0; background-color: red; color: white;">X</button>
            </div>
        {% endfor %}
    {% endif %}
    <br>
    <h3>Contact Details</h3>
    <label for="email">Email:</label>
    <input type="email" id="email" name="email" value="{{ user_email }}">
    <br>
    <label for="tel">Telephone:</label>
    <input type="tel" id="tel" name="tel" value="{{ user_tel }}">
    <br>
    <label for="instagram">Instagram:</label>
    <input type="text" id="instagram" name="instagram" value="{{ user_instagram }}">
    <br>
    <label for="telegram">Telegram:</label>
    <input type="text" id="telegram" name="telegram" value="{{ user_telegram }}">
    <br>
    <button type="submit">Save</button>
</form>
<script>
document.querySelectorAll('.delete-photo').forEach(button => {
    button.addEventListener('click', function() {
        const filename = this.getAttribute('data-filename');
        fetch(`/delete_photo/${filename}`, {
            method: 'POST'
        }).then(response => response.json()).then(data => {
            if (data.status === 'success') {
                this.parentElement.remove();
            } else {
                alert(data.message);
            }
        });
    });
});
</script>
{% endblock %}
